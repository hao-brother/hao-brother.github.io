
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>蓝桥杯-第六届(温度记录) - Hexo</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="这是我自己在学习蓝桥杯过程中总结的一些知识，希望对今后的学习和备战蓝桥的同学能够提供一些帮助吧。蓝桥杯-第六届(温度记录)1.试题要求如下
2.题目要点分析1）指示符在显示时，需要闪烁(可以根据奇或,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Hexo" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Hexo</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://yoursite.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">蓝桥杯-第六届(温度记录)</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">蓝桥杯-第六届(温度记录)</h1>
        <div class="stuff">
            <span>四月 18, 2020</span>
            

        </div>
        <div class="content markdown">
            <h3 id="这是我自己在学习蓝桥杯过程中总结的一些知识，希望对今后的学习和备战蓝桥的同学能够提供一些帮助吧。"><a href="#这是我自己在学习蓝桥杯过程中总结的一些知识，希望对今后的学习和备战蓝桥的同学能够提供一些帮助吧。" class="headerlink" title="这是我自己在学习蓝桥杯过程中总结的一些知识，希望对今后的学习和备战蓝桥的同学能够提供一些帮助吧。"></a>这是我自己在学习蓝桥杯过程中总结的一些知识，希望对今后的学习和备战蓝桥的同学能够提供一些帮助吧。</h3><h2 id="蓝桥杯-第六届-温度记录"><a href="#蓝桥杯-第六届-温度记录" class="headerlink" title="蓝桥杯-第六届(温度记录)"></a>蓝桥杯-第六届(温度记录)</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><h3 id="试题要求如下"><a href="#试题要求如下" class="headerlink" title="试题要求如下"></a>试题要求如下</h3><p><img src="https://gitee.com/two_finger_meditation/bed/raw/master/img/6.png" alt=""></p>
<h3 id="2-题目要点分析"><a href="#2-题目要点分析" class="headerlink" title="2.题目要点分析"></a>2.题目要点分析</h3><h5 id="1）指示符在显示时，需要闪烁-可以根据奇或偶来进行判断"><a href="#1）指示符在显示时，需要闪烁-可以根据奇或偶来进行判断" class="headerlink" title="1）指示符在显示时，需要闪烁(可以根据奇或偶来进行判断)"></a>1）指示符在显示时，需要闪烁(可以根据奇或偶来进行判断)</h5><h5 id="2-按下-s6-后，自动显示索引、各个温度-10个"><a href="#2-按下-s6-后，自动显示索引、各个温度-10个" class="headerlink" title="2)  按下 s6 后，自动显示索引、各个温度(10个)"></a>2)  按下 s6 后，自动显示索引、各个温度(10个)</h5><h3 id="3-注意事项"><a href="#3-注意事项" class="headerlink" title="3.注意事项"></a>3.注意事项</h3><h5 id="1）运用到了以前几届的-DS18820-和-DS1302知识"><a href="#1）运用到了以前几届的-DS18820-和-DS1302知识" class="headerlink" title="1）运用到了以前几届的 DS18820 和 DS1302知识"></a>1）运用到了以前几届的 DS18820 和 DS1302知识</h5><h5 id="2）本届难度不大，综合运用了前边的知识"><a href="#2）本届难度不大，综合运用了前边的知识" class="headerlink" title="2）本届难度不大，综合运用了前边的知识"></a>2）本届难度不大，综合运用了前边的知识</h5><h3 id="4-代码实现"><a href="#4-代码实现" class="headerlink" title="4.代码实现"></a>4.代码实现</h3><h5 id="开始的一些初始化之类的和第三届一样，这里不再分开叨叙-一笔简明带过-，忘记的朋友可以去看第三届解析"><a href="#开始的一些初始化之类的和第三届一样，这里不再分开叨叙-一笔简明带过-，忘记的朋友可以去看第三届解析" class="headerlink" title="开始的一些初始化之类的和第三届一样，这里不再分开叨叙(一笔简明带过)，忘记的朋友可以去看第三届解析"></a>开始的一些初始化之类的和第三届一样，这里不再分开叨叙(一笔简明带过)，忘记的朋友可以去看第三届解析</h5><pre><code class="c">#include &quot;stc15f2k60s2.h&quot;
#include &quot;ds18b20.h&quot;
#include &quot;ds1302.h&quot;

uchar tab[]={0xc0,
             0xf9,0xa4,0xB0,0x99,0x92,0x82,0xf8,0x80,0x90,
             0xbf,0x7f,0xff}; // - . 

uint yi=0;uint er=0;uint san=0;uint si=0;
uint wu=0;uint liu=0;uint qi=0;uint ba=0;                                          

uchar time_between=1;     // 采集时间间隔     1 5 30 60采集
uchar caiji=0;                         
extern uchar shijian[];     // 1302 时间数组
uint tt=0;                 // 中断计数        
uchar save[10];          // 保留10次采集的温度记录在数组中
uchar save_n=0;             // 与数组下标对应
uchar wendu;             // 读取温度寄存             
bit led1_spot=0;         // 小灯开启标志位
bit fla=0;                 // 小灯闪烁标志位

void delayms(uint ms)  
{
    uint a;
     for(;ms&gt;0;ms--)
     {
        for(a=845;a&gt;0;a--);
     }
}

void allinit(void) 
{
  P2=0XA0;          
  P0=0X00;

  P2=0X80;         
  P0=0XFF;            

  P2=0XC0;         
  P0=0XFF;

  P2=0XFF;
  P0=0XFF;
}



void display(uchar channel,uchar number)        
{
    P2=0XC0;                                   
    P0=0X01&lt;&lt;channel;

    P2=0XFF;                                  
    P0=tab[number];
    delayms(1);
}

void show_SMG()
{
display(0,yi);
display(1,er);
display(2,san);
display(3,si);

display(4,wu);
display(5,liu);
display(6,qi);    
display(7,ba);    

    P2=0XC0;  // 防止最后一个数码管过亮
    P0=0XFF;
    P2=0XFF;
    P0=0XFF;

}</code></pre>
<h5 id="官方提供的-ds18b20-代码资料-—-需修改-—-重点"><a href="#官方提供的-ds18b20-代码资料-—-需修改-—-重点" class="headerlink" title="官方提供的 ds18b20 代码资料 — 需修改 — 重点"></a>官方提供的 ds18b20 代码资料 — 需修改 — 重点</h5><pre><code class="c">  /************************************************/ // 以下为官方提供
#include &quot;stc15f2k60s2.h&quot;
#include &quot;ds18b20.h&quot;
sbit DQ = P1^4;  

void Delay_OneWire(unsigned int t)  
{
    unsigned char i;
    while(t--){
        for(i=0; i&lt;8; i++);
    }
}

void Write_DS18B20(unsigned char dat)  // 写
{
    unsigned char i;
    for(i=0;i&lt;8;i++)
    {
        DQ = 0;
        DQ = dat&amp;0x01;
        Delay_OneWire(5);
        DQ = 1;
        dat &gt;&gt;= 1;
    }
    Delay_OneWire(5);
}

unsigned char Read_DS18B20(void)  // 读
{
    unsigned char i;
    unsigned char dat;

    for(i=0;i&lt;8;i++)
    {
        DQ = 0;
        dat &gt;&gt;= 1;
        DQ = 1;
        if(DQ)
        {
            dat |= 0x80;
        }        
        Delay_OneWire(5);
    }
    return dat;
}

bit init_ds18b20(void)  // ds18b20初始化
{
      bit initflag = 0;

      DQ = 1;
      Delay_OneWire(12);
      DQ = 0;
      Delay_OneWire(80);
      DQ = 1;
      Delay_OneWire(10); 
        initflag = DQ;     
      Delay_OneWire(5);

      return initflag;
}

  /*********************************************/  //以下需要自己写

unsigned char Tempget(void)
{
    unsigned char low,high,temp;

    /***************************/ // 温度读取
    init_ds18b20();
    Write_DS18B20(0XCC);   // 18b20手册
    Write_DS18B20(0x44);    
    Delay_OneWire(100);



    /***************************/ // 温度进行转化
    init_ds18b20();
    Write_DS18B20(0xcc);
    Write_DS18B20(0xbe);


    low=Read_DS18B20();
    high=Read_DS18B20();


    temp=high&lt;&lt;4;      // 注意此处
    temp|=(low&gt;&gt;4);

    return temp;
}</code></pre>
<h5 id="官方提供的-ds1302-代码资料-—-需修改-—-重点"><a href="#官方提供的-ds1302-代码资料-—-需修改-—-重点" class="headerlink" title="官方提供的 ds1302 代码资料 — 需修改 — 重点"></a>官方提供的 ds1302 代码资料 — 需修改 — 重点</h5><pre><code class="c">#include &lt;STC15F2K60S2.H&gt;
#include &lt;intrins.h&gt;
#include &quot;ds1302.h&quot;

sbit SCK=P1^7;        
sbit SDA=P2^3;        
sbit RST = P1^3;                                       

void Write_Ds1302_Byte(unsigned  char temp) 
{
    unsigned char i;
    for (i=0;i&lt;8;i++)         
    { 
        SCK=0;
        SDA=temp&amp;0x01;
        temp&gt;&gt;=1; 
        SCK=1;
    }
}   

void Write_Ds1302( unsigned char address,unsigned char dat )     
{
     RST=0;
    _nop_();
     SCK=0;
    _nop_();
     RST=1;    
       _nop_();  
     Write_Ds1302_Byte(address);    
     //Write_Ds1302_Byte(dat);        
    // 需要修改如下
    Write_Ds1302_Byte((dat/10&lt;&lt;4)|(dat%10)); // 修改后的
     RST=0; 
}

unsigned char Read_Ds1302 ( unsigned char address )
{
     unsigned char i,temp=0x00;
    uchar dat1,dat2; // 修改添加的

     RST=0;
    _nop_();
     SCK=0;
    _nop_();
     RST=1;
    _nop_();
     Write_Ds1302_Byte(address);
     for (i=0;i&lt;8;i++)     
     {        
        SCK=0;
        temp&gt;&gt;=1;    
         if(SDA)
         temp|=0x80;    
         SCK=1;
    } 
     RST=0;
    _nop_();
     RST=0;
    SCK=0;
    _nop_();
    SCK=1;
    _nop_();
    SDA=0;
    _nop_();
    SDA=1;
    _nop_();

    dat1=temp/16;  // 10进制与16进制的转化
    dat2=temp%16;
    temp=dat1*10+dat2; // 三行自己添加的
    return (temp);            
}

  /**********************************/ // 以下需要自己写的
uchar shijian[]={50,59,23,0,0,0,0};     // 秒分时 日月周年
void DS_Write(void)
{
uchar i,add;
    add=0x80;  // 0x80 写  0x81 读
    Write_Ds1302(0x8e,0x00); // 开始对其 写(0x00)
    for(i=0;i&lt;7;i++)
    {
    Write_Ds1302(add,shijian[i]);
        add+=2;          // 1302 每次增加2
    }
    Write_Ds1302(0x8e,0x80); // 80 关闭

}

void DS_Read(void)
{
uchar i,add;
    add=0x81;    // 0x81 读取
    Write_Ds1302(0x8e,0x00);
  for(i=0;i&lt;7;i++)
    {
    shijian[i]=Read_Ds1302(add);

    add+=2;
    }
 Write_Ds1302(0x8e,0x80); // 80 关闭

}
</code></pre>
<h5 id="中断函数-—-重要"><a href="#中断函数-—-重要" class="headerlink" title="中断函数  —  重要"></a>中断函数  —  重要</h5><pre><code class="c">void Timer0Init(void)  // 0  5ms
{
    AUXR |=0X80;
    TMOD &amp;=0XF0;
    TL0=0X00;
    TH0=0X28;
    TF0=0;
    TR0=1;
    EA=1;
    ET0=1;
}

void timer0 () interrupt 1
{
    tt++;
    if(caiji==1)
    {
      if(tt==200*time_between)    // 化为1s * 变成间隔多长时间进行采集 
        {
            tt=0;             
            save[save_n]=wendu;
            save_n++;
              if(save_n==10)
             {
                caiji=2;              // 采集完成标志位
                save_n=0;
                er=san=0;si=wu=12;    // 显示规定的显示
                yi=liu=10;
                qi=save[0]/10;
                ba=save[0]%10; 
                led1_spot=1;          // 小灯开始闪烁的标志位 标志采集完成
             }
        }
    }

    if((caiji==2)&amp;&amp;(tt==200)) // 1s 采集完成 闪烁  
    {
        tt=0;
        if(led1_spot==1)       // 小灯开始闪烁标志位  
        {
            if(fla==0)         // 控制小灯闪烁
            {
                P2=0X80;
                P0=0xfe;
                fla=1;
            }
            else if(fla==1)
            {
                P2=0X80;
                P0=0XFF;
                fla=0;
            }
        }

        else if(led1_spot==0)    // 小灯闪烁标志位为关闭状态
        {                        // 当caiji=2,标志着采集完成，此时按下s6,led1_spot变为0，
                                 // 依次显示已经保存的10个温度  索引值也随之改变 
            yi=liu=10;si=wu=12;
            er=save_n/10;
            san=save_n%10;
            qi=save[save_n]/10;
            ba=save[save_n]%10;
            save_n++;
            if(save_n==10)
            {
                save_n=0;
                caiji=3;         // caiji=3,已经显示完了已保存的温度
            }
        }

    }

}</code></pre>
<h5 id="按键功能操作-—-重点"><a href="#按键功能操作-—-重点" class="headerlink" title="按键功能操作 — 重点"></a>按键功能操作 — 重点</h5><pre><code class="c">void keyscan4()
{
if(P30==0)
  {
        delayms(5);
     if(P30==0)
         {
             if(caiji==3)   // caiji=3,已经依次显示完了已保存的温度
             {
               caiji=0;     // 恢复s4的再次按键控制作用
             }
         }while(!P30);
    }

if(P31==0)
  {
        delayms(5);
      if(P31==0)
       {
             if(caiji==2)   // 采集完成后的标志位---也就是依次显示
             {
              led1_spot=0;  // 关闭小灯闪烁
              P2=0X80;
              P0=0XFF;
             }
         }while(!P31);
    }    

if(P32==0)
  {
      delayms(5);
        if(P32==0)
        {
            if(caiji==0)    // 采集开始后标志为1
            {
             caiji=1;
            }
            tt=0;           // 再次计数时，恢复中断的计数器
                            // (当caiji==3时，标志已经依次显示完温度)
                            // 此时tt已经自动计数到很大了，进不到中断判断中，故需清零
        }while(!P32);
    }

if(P33==0)           // s4
  {
      delayms(5);
       if(P33==0)
         {
             if(caiji==0)           // 采集未开始标志
             {
                 if(time_between==1)    // 按下切换采集间隔时间
                 {
                 time_between=5;
                 }
                 else if(time_between==5)
                 {
                 time_between=30;
                 }
                 else if(time_between==30)
                 {
                 time_between=60;
                 }
                 else if(time_between==60)
                 {
                 time_between=1;
                 }
             }
         }while(!P33);
}
}</code></pre>
<h5 id="主函数中对标志位进行判断-—-重点"><a href="#主函数中对标志位进行判断-—-重点" class="headerlink" title="主函数中对标志位进行判断 — 重点"></a>主函数中对标志位进行判断 — 重点</h5><pre><code class="c">void main()
{
    allinit();
    DS_Write();      // 初始化1302
    Timer0Init();

    yi=er=san=si=wu=12;
    liu=10;qi=0;ba=1;

 while(1)
 {
       wendu=Tempget();
     if(caiji==0)   // 采集未开始标志
     {              // 显示 1 5 30 60 采集时间设定
       yi=er=san=si=wu=12;
       liu=10;
       qi=time_between/10;
       ba=time_between%10;
     }
     else if(caiji==1) // 开始采集的标志
     {
         DS_Read();    // 读取1302时间
         yi=shijian[2]/10;er=shijian[2]%10;san=10;
         si=shijian[1]/10;wu=shijian[1]%10;liu=10; // 分隔符
         qi=shijian[0]/10;ba=shijian[0]%10;

         if(shijian[0]%2==0)  // 横杠闪烁 
         {
         san=liu=10;   // 横杠
         }
         else
         {
         san=liu=12;
         }
     }
   show_SMG();
   keyscan4();
 }

}</code></pre>
<hr>
<h4 id="版权所有，未经允许，不得转载"><a href="#版权所有，未经允许，不得转载" class="headerlink" title="版权所有，未经允许，不得转载 !"></a>版权所有，未经允许，不得转载 !</h4>
            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='https://link.hhtjim.com/163/438900437.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='https://link.hhtjim.com/163/438900437.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='false'
        data-ci='6ad24f2be059b1d2fb20'
        data-cs='ee483db219a5b74594455a4ad59c2a81ed2b6717'
        data-r='hao-brother.github.io'
        data-o='hao-brother'
        data-a='hao-brother'
        data-d='true'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
